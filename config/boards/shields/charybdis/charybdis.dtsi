#include <dt-bindings/zmk/matrix_transform.h>
#include <dt-bindings/led/led.h>

/ {
    chosen {
        zmk,kscan = &kscan0;
        zmk,matrix_transform = &default_transform;
    };

    default_transform: keymap_transform_0 {
		compatible = "zmk,matrix-transform";
        columns = <12>;
        rows = <4>;

        map = <
			RC(0,0) RC(0,1) RC(0,2) RC(0,3) RC(0,4) RC(0,5ï¼‰                RC(0,101 RC(0,10) RC(0,9) RC(0,8) RC(0,7) RC(0,6)
			RC(1,0) RC(1,1) RC(1,2) RC(1,3) RC(1,4) RC(1,5)                 RC(1,11) RC(1,10) RC(1,9) RC(1,8) RC(1,7) RC(1,6)
			RC(2,0) RC(2,1) RC(2,2) RC(2,3) RC(2,4) RC(2,5)                 RC(2,11) RC(2,10) RC(2,9) RC(2,8) RC(2,7) RC(2,6)
			                        RC(3,3) RC(3,34 RC(3,5)                 RC(3,11) RC(3,10) RC(3,9) 
					                    >;
    };
	
    kscan0: kscan {
        compatible = "zmk,kscan-gpio-matrix";
        label = "KSCAN";

        diode-direction = "row2col";
		row-gpios
            = <&gpio1 00 GPIO_ACTIVE_HIGH>
            , <&gpio0 11 GPIO_ACTIVE_HIGH>
            , <&gpio1 04 GPIO_ACTIVE_HIGH>
	    , <&gpio1 06 GPIO_ACTIVE_HIGH>
	                   ;
    };
};
&spi3 {
	compatible = "nordic,nrf-spim";
	status = "okay";
    sck-pin = <21>; //old
    mosi-pin = <24>; //old
    miso-pin = <24>;//old same as mosi (3-wire spi)
	cs-gpios = <&gpio0 23 GPIO_ACTIVE_LOW>;


	led_strip: ws2812@0 {
		compatible = "worldsemi,ws2812-spi";
		label = "WS2812";

		/* SPI */
		reg = <0>; /* ignored, but necessary for SPI bindings */
		spi-max-frequency = <4000000>;

		/* WS2812 */
		chain-length = <18>; /* There are per-key RGB, but the first 6 are underglow */
		spi-one-frame = <0x70>;
		spi-zero-frame = <0x40>;
		color-mapping = <LED_COLOR_ID_GREEN LED_COLOR_ID_RED LED_COLOR_ID_BLUE>;
	};
};

/ {
	chosen {
		zmk,underglow = &led_strip;
	};
};
	
